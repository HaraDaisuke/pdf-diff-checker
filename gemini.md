### 📄 システム名：`pdf-diff-checker`

### 📋 1. システム概要
製造業で利用される**設計図面PDF**の修正前後を比較し、変更箇所を迅速かつ正確に検出するためのWebシステム。

---

### ⚙️ 2. 技術要件

* **バックエンド**: **FastAPI**と**Python**を使用。
    * **Pythonライブラリ**: `PyMuPDF`（PDFから画像を抽出）、`OpenCV`または`Pillow`（画像処理、差分検出）を利用。
    * **設計**: 機能ごとにモジュールを分割し、再利用性を確保。

* **フロントエンド**: **Vue.js**を使用。
    * **設計**: コンポーネント指向で、UI機能をモジュール化し、保守性を高める。

---

### 🚀 3. 機能要件

#### 3-1. PDF読み込み機能
* **方法**: Web画面上へのドラッグ＆ドロップによるPDFファイルのアップロード。
* **ファイル形式**: PDF（.pdf）のみに対応。
* **処理対象**: 修正前と修正後のPDFをそれぞれアップロード。基本的には1ページを想定。

#### 3-2. 画像化処理
* アップロードされた2つのPDFを、バックエンドのPythonで高解像度の画像データに変換。

#### 3-3. 比較・差分検出機能
* 画像化された2つの設計図面をピクセル単位で比較。
* **検出対象**: 文字や線画の**追加**、**削除**、**変更**を正確に検出する。線の太さや位置のわずかなずれも検知。
* **処理速度**: 1ページあたり**30秒以内**での完了を目指す。

#### 3-4. UI表示機能
* **表示方式**: 修正前PDFの画像に、差分箇所を重ねて表示。
* **マーキング**: 検出された差分箇所を**赤いハイライト**で強調表示。
* **画面構成**:
    * PDFをアップロードするためのエリア。
    * 比較結果の画像を表示するエリア。

---

### ⚠️ 4. 今後の検討事項

* 異なるサイズや向きのPDFがアップロードされた場合の処理方法。
* 30秒の処理速度目標を達成するための、画像差分アルゴリズムの選定と最適化。
* 処理中にエラーが発生した場合の、ユーザーへの適切なフィードバック（エラーハンドリング）。

---

### 📝 5. 処理フロー

#### 5-1. アップロードとリクエスト送信

1.  **ユーザー**: Web画面上で、比較したい2つのPDFファイル（修正前、修正後）をドラッグ＆ドロップで指定します。
2.  **フロントエンド (Vue.js)**: 指定されたPDFファイルをバックエンドの**FastAPI**に送信するリクエストを作成します。

#### 5-2. バックエンドでの処理

1.  **FastAPI**: リクエストを受け取り、アップロードされた2つのPDFファイルを一時的な保存場所に保管します。
2.  **Pythonモジュール（PDF処理）**:
    * 2つのPDFをそれぞれ読み込みます。
    * 各PDFの1ページ目を高解像度の画像データ（例：PNG形式）に変換します。
3.  **Pythonモジュール（画像比較）**:
    * 変換された2つの画像データを取得します。
    * `OpenCV`などのライブラリを用いて、ピクセル単位で差分を検出します。
    * 差分がある箇所を特定し、その位置情報を記録します。
4.  **Pythonモジュール（画像生成）**:
    * 修正前PDFの画像データに、検出された差分位置情報をもとに赤いハイライトを重ねて描画します。
    * この「差分ハイライト付き画像」を生成します。

#### 5-3. 結果の表示

1.  **FastAPI**: 生成された「差分ハイライト付き画像」を、フロントエンドの**Vue.js**に送信します。
2.  **フロントエンド (Vue.js)**:
    * バックエンドから受け取った画像データをWeb画面上に表示します。
    * ユーザーは画面上で、赤いハイライトで示された差分箇所を確認できます。

---